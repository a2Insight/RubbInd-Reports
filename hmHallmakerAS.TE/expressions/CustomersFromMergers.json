{
  "name": "CustomersFromMergers",
  "kind": "m",
  "expression": [
    "let",
    "",
    "    table1 = \"Companies\",",
    "    table2 =\"Kunder\",",
    "",
    "    sqlDatabase = Sql.Database(SQLserver1, SQLdatabase1),",
    "    sqlTbl1 = sqlDatabase{[Schema=\"dbo\",Item=(table1)]}[Data],",
    "    sqlTbl2 = sqlDatabase{[Schema=\"dbo\",Item=(table2)]}[Data],",
    "",
    "    Source = PaymentsFromMergers,",
    "    InsertFromCompany = Table.AddColumn(Source, \"FromCompany\", each Text.BeforeDelimiter([KundeLnk], \"-\"), type number),",
    "    #\"Removed Other Columns\" = Table.SelectColumns(InsertFromCompany,{\"KundeLnk\"}),",
    "    NewAccounts = Table.Distinct(#\"Removed Other Columns\"),",
    "    FromComp = Table.Group(InsertFromCompany, {\"FromCompany\"}, {{\"Count\", each Table.RowCount(_), type number}}),",
    "    #\"Changed Type2\" = Table.TransformColumnTypes(FromComp,{{\"FromCompany\", Int64.Type}}),",
    "    #\"Merged Queries\" = Table.NestedJoin(sqlTbl1,{\"CompanyId\"},#\"Changed Type2\",{\"FromCompany\"},\"Custom1\",JoinKind.Inner),",
    "    #\"Removed Columns\" = Table.RemoveColumns(#\"Merged Queries\",{\"Custom1\"}),",
    "    #\"Merged Queries1\" = Table.NestedJoin(sqlTbl2,{\"FirmaId\"},#\"Removed Columns\",{\"InfoEasyId\"},\"Removed Columns\",JoinKind.Inner),",
    "    #\"Expanded Removed Columns\" = Table.ExpandTableColumn(#\"Merged Queries1\", \"Removed Columns\", {\"CompanyId\"}, {\"CompanyId\"}),",
    "    #\"Added Custom\" = Table.AddColumn(#\"Expanded Removed Columns\", \"KLnk\", each Text.From([CompanyId])&\"-\"&Text.From([KundeId])),",
    "    #\"Merged Queries2\" = Table.NestedJoin(#\"Added Custom\",{\"KLnk\"},NewAccounts,{\"KundeLnk\"},\"Added Custom\",JoinKind.Inner),",
    "    #\"Added Custom1\" = Table.AddColumn(#\"Merged Queries2\", \"Custom\", each \"HM \"&[Kunde]),",
    "    #\"Removed Columns1\" = Table.RemoveColumns(#\"Added Custom1\",{\"FirmaId\", \"KundeLnk\", \"CompanyId\", \"Added Custom\", \"Kunde\"}),",
    "    #\"Renamed Columns1\" = Table.RenameColumns(#\"Removed Columns1\",{{\"KLnk\", \"KundeLnk\"}, {\"Custom\", \"Kunde\"}}),",
    "    #\"Changed Type\" = Table.TransformColumnTypes(#\"Renamed Columns1\",{{\"KundeLnk\", type text}, {\"Kunde\", type text}})",
    "in",
    "    #\"Changed Type\""
  ],
  "queryGroup": "Hjelpetabeller",
  "lineageTag": "49901d2d-9a4a-4e97-8293-d14dcb81828e",
  "annotations": [
    {
      "name": "PBI_NavigationStepName",
      "value": "Navigation"
    },
    {
      "name": "PBI_ResultType",
      "value": "Table"
    }
  ]
}