{
  "name": "Prosjekt",
  "mode": "import",
  "queryGroup": "Dimensjoner",
  "source": {
    "type": "m",
    "expression": [
      "let",
      "   ",
      "/*",
      "//SharePoint",
      "",
      "    SharePoint = SharePoint.Tables(SharePointSite1, [ApiVersion = 15]),",
      "    Company = SharePoint{[Id=\"c6c05096-82a1-486e-af74-d9aca84f2740\"]}[Items],",
      "    SelectColumns = Table.RemoveColumns(Company,{\"FileSystemObjectType\", \"Id\", \"ServerRedirectedEmbedUri\", \"ServerRedirectedEmbedUrl\", \"ContentTypeId\", \"ComplianceAssetId\", \"Modified\", \"Created\", \"AuthorId\", \"EditorId\", \"OData__UIVersionString\", \"Attachments\", \"GUID\", \"FirstUniqueAncestorSecurableObject\", \"RoleAssignments\", \"Activities\", \"AttachmentFiles\", \"ContentType\", \"GetDlpPolicyTip\", \"FieldValuesAsHtml\", \"FieldValuesAsText\", \"FieldValuesForEdit\", \"File\", \"Folder\", \"LikedByInformation\", \"ParentList\", \"Properties\", \"Versions\", \"Author\", \"Editor\", \"ID\"}),",
      "    RenameColumns = Table.RenameColumns(SelectColumns,{{\"Title\", \"Company\"}}),",
      "",
      "//SQL",
      "",
      "    table1 = \"Prosjekter\",",
      "    sqlDatabase = Sql.Database(SQLserver1, SQLdatabase1),",
      "    sqlTbl1 = sqlDatabase{[Schema=\"dbo\",Item=(table1)]}[Data],",
      "*/",
      "//Procedure",
      "    #\"Merged Queries\" = Table.NestedJoin(SQL_Projects,{\"FirmaId\"},SQL_Company,{\"InfoEasyId\"},\"Companies\",JoinKind.Inner),",
      "    #\"Expanded Companies\" = Table.ExpandTableColumn(#\"Merged Queries\", \"Companies\", {\"CompanyId\"}, {\"CompanyId\"}),",
      "    #\"Sorted Rows1\" = Table.Sort(#\"Expanded Companies\",{{\"ProsjektId\", Order.Ascending}}),",
      "    #\"Renamed Columns\" = Table.RenameColumns(#\"Sorted Rows1\",{{\"ProsjektLnk\", \"ProsjektLnkOld\"}}),",
      "",
      "    #\"Added Custom\" = Table.AddColumn(#\"Renamed Columns\", \"ProsjektLnk\", each Text.From([CompanyId])&\"-\"&Text.From([ProsjektId])),",
      "    filterColumns = Table.RemoveColumns(#\"Added Custom\",{\"FirmaId\", \"ProsjektLnkOld\"}),",
      "    columns2Norwegian = Table.RenameColumns(filterColumns,{{\"ProsjektId\", \"ProsjektNummer\"}}),",
      "    #\"Added Custom1\" = Table.AddColumn(columns2Norwegian, \"Custom\", each if [HovedArbeidProsjektNr] <> null then [HovedArbeidProsjektNr] else [ProsjektNummer]),",
      "    #\"Removed Columns\" = Table.RemoveColumns(#\"Added Custom1\",{\"HovedArbeidProsjektNr\"}),",
      "    #\"Renamed Columns1\" = Table.RenameColumns(#\"Removed Columns\",{{\"Custom\", \"HovedArbeidProsjektNr\"}}),",
      "    #\"Sorted Rows\" = Table.Sort(#\"Renamed Columns1\",{{\"HovedArbeidProsjektNr\", Order.Ascending},{\"ProsjektLnk\", Order.Ascending}}),",
      "    #\"Replaced Value\" = Table.ReplaceValue(#\"Sorted Rows\",\",,,,,,,,,,,,,,,,,,,,\",\"SLETT\",Replacer.ReplaceText,{\"ProsjektNummer\"}),",
      "    #\"Filtered Rows1\" = Table.SelectRows(#\"Replaced Value\", each ([ProsjektNummer] <> \"SLETT\")),",
      "    #\"Added Custom2\" = Table.AddColumn(#\"Filtered Rows1\", \"HovedProsjekt\", each if [Prosjekt] = null then \"\" else if [ProsjektNummer] = [HovedArbeidProsjektNr] then [Prosjekt] else null),",
      "    #\"Filled Down\" = Table.FillDown(#\"Added Custom2\",{\"HovedProsjekt\"}),",
      "    #\"Added Custom3\" = Table.AddColumn(#\"Filled Down\", \"HP Beskrivelse\", each if Text.Length([HovedProsjekt])>0 then [HovedArbeidProsjektNr]&\" - \"&[HovedProsjekt] else [HovedArbeidProsjektNr]),",
      "    #\"Added Custom4\" = Table.AddColumn(#\"Added Custom3\", \"Delprosjekt\", each Text.AfterDelimiter([Prosjekt], \"_\", {0, RelativePosition.FromEnd})),",
      "    #\"Added Custom5\" = Table.AddColumn(#\"Added Custom4\", \"DelprosjektNummer\", each Text.AfterDelimiter([ProsjektNummer], \"-\", {0, RelativePosition.FromEnd})),",
      "    #\"Added Custom6\" = Table.AddColumn(#\"Added Custom5\", \"DP Beskrivelse\", each if [HovedArbeidProsjektNr] = [DelprosjektNummer] then \" \"&[DelprosjektNummer] &\"   \"&[Delprosjekt] else [DelprosjektNummer]&\"-\"&[Delprosjekt], type text),",
      "    #\"Added Custom7\" = Table.AddColumn(#\"Added Custom6\", \"OrgVarighet\", each if [StartDato] = null then 0 else if [PlanFerdigDato] = null then 0 else Number.From([PlanFerdigDato])-Number.From([StartDato])),",
      "    #\"Changed Type\" = Table.TransformColumnTypes(#\"Added Custom7\",{{\"StartDato\", type date}, {\"PlanFerdigDato\", type date}, {\"FerdigDato\", type date}, {\"OrgVarighet\", Int64.Type}, {\"HovedArbeidProsjektNr\", type text}, {\"HP Beskrivelse\", type text}, {\"HovedProsjekt\", type text}, {\"ProsjektLnk\", type text}, {\"Avdeling\", type text}}),",
      "    #\"Removed Columns1\" = Table.RemoveColumns(#\"Changed Type\",{\"OrdreDato\"})",
      "in",
      "    #\"Removed Columns1\""
    ]
  }
}