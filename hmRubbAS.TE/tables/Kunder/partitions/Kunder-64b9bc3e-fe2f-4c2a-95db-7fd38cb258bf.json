{
  "name": "Kunder-64b9bc3e-fe2f-4c2a-95db-7fd38cb258bf",
  "mode": "import",
  "queryGroup": "Dimensjoner",
  "source": {
    "type": "m",
    "expression": [
      "let",
      "",
      "/*",
      "//SharePoint",
      "",
      "    SharePoint = SharePoint.Tables(SharePointSite1, [ApiVersion = 15]),",
      "    CompanyTbl = SharePoint{[Id=\"c6c05096-82a1-486e-af74-d9aca84f2740\"]}[Items],",
      "    SelectColumns = Table.RemoveColumns(CompanyTbl,{\"FileSystemObjectType\", \"Id\", \"ServerRedirectedEmbedUri\", \"ServerRedirectedEmbedUrl\", \"ContentTypeId\", \"ComplianceAssetId\", \"Modified\", \"Created\", \"AuthorId\", \"EditorId\", \"OData__UIVersionString\", \"Attachments\", \"GUID\", \"FirstUniqueAncestorSecurableObject\", \"RoleAssignments\", \"Activities\", \"AttachmentFiles\", \"ContentType\", \"GetDlpPolicyTip\", \"FieldValuesAsHtml\", \"FieldValuesAsText\", \"FieldValuesForEdit\", \"File\", \"Folder\", \"LikedByInformation\", \"ParentList\", \"Properties\", \"Versions\", \"Author\", \"Editor\", \"ID\"}),",
      "    RenameColumns = Table.RenameColumns(SelectColumns,{{\"Title\", \"Company\"}}),",
      "    Company = Table.SelectRows(RenameColumns, each [Company] = companyId),",
      "",
      "//SQL",
      "",
      "    table1 = \"Kunder\",",
      "    sqlDatabase = Sql.Database(SQLserver1, SQLdatabase1),",
      "    sqlTbl1 = sqlDatabase{[Schema=\"dbo\",Item=(table1)]}[Data],",
      "*/",
      "",
      "//Procedure",
      "    #\"Merged Queries\" = Table.NestedJoin(SQL_Customers,{\"FirmaId\"},SQL_Company,{\"InfoEasyId\"},\"Temp\",JoinKind.Inner),",
      "    #\"Expanded Temp\" = Table.ExpandTableColumn(#\"Merged Queries\", \"Temp\", {\"CompanyId\"}, {\"CompanyId\"}),",
      "    #\"Added Custom\" = Table.AddColumn(#\"Expanded Temp\", \"Custom\", each if Text.Length(Text.From([KundeId])) = 0 then null else Text.From([CompanyId])&\"-\"&Text.From([KundeId])),",
      "    #\"Removed Columns1\" = Table.RemoveColumns(#\"Added Custom\",{\"FirmaId\", \"KundeLnk\", \"CompanyId\"}),",
      "    #\"Renamed Columns\" = Table.RenameColumns(#\"Removed Columns1\",{{\"Custom\", \"KundeLnk\"}}),",
      "    #\"Replaced Value\" = Table.ReplaceValue(#\"Renamed Columns\",null,\"\",Replacer.ReplaceValue,{\"Kunde\"}),",
      "    #\"Duplicated Column\" = Table.DuplicateColumn(#\"Replaced Value\", \"Kunde\", \"Kunde - Copy\"),",
      "    #\"Uppercased Text\" = Table.TransformColumns(#\"Duplicated Column\",{{\"Kunde - Copy\", Text.Upper, type text}}),",
      "    #\"Added Conditional Column\" = Table.AddColumn(#\"Uppercased Text\", \"IC Kunder\", each if Text.Contains([#\"Kunde - Copy\"], \"HALLMAKER\") then 1 else if Text.Contains([#\"Kunde - Copy\"], \"RUBB\") then 1 else 0),",
      "    #\"Removed Columns\" = Table.RemoveColumns(#\"Added Conditional Column\",{\"Kunde - Copy\"}),",
      "    #\"Changed Type\" = Table.TransformColumnTypes(#\"Removed Columns\",{{\"KundeId\", Int64.Type}, {\"Kunde\", type text}, {\"KundeLnk\", type text}, {\"IC Kunder\", type logical}})",
      "in",
      "    #\"Changed Type\""
    ]
  }
}